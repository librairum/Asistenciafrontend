<p-toast></p-toast>
<p-confirmDialog
    [acceptLabel]="'Sí, eliminar'"
    [rejectLabel]="'No, cancelar'"
    acceptButtonStyleClass="p-button-danger"
></p-confirmDialog>



<div class="container">
    <p-panel header="Asignación de horarios" class="mb-3">
      <p-breadcrumb [model]="items" class="max-w-full"></p-breadcrumb>
    </p-panel>

    <div class="card">
        <p-dialog
            header="Configuración"
            [(visible)]="displayModal"
            [modal]="true"
            [style]="{ width: '600px' }"
            [closable]="false"
        >
            <p-table [value]="diasSemana">
              <ng-template pTemplate="header">
                <tr>
                  <th>Día</th>
                  <th>Motivo</th>
                  <th>Hora Ingreso</th>
                  <th>Hora Salida</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-dia>
                <tr>
                  <td>{{ dia.nombre }}</td>

                  <td>
                    <p-dropdown
                      [options]="motivos"
                      optionLabel="descripcion"
                      optionValue="idMotivo"
                      [(ngModel)]="getDatosDia(dia.codigo).idMotivo"
                      (onChange)="actualizarHorasSiMotivoInactivo(getDatosDia(dia.codigo))"
                      placeholder="Seleccione motivo"
                      class="w-full">
                    </p-dropdown>
                  </td>

                  <td>
                    <p-calendar
                        [(ngModel)]="getDatosDia(dia.codigo).horaingreso"
                        timeOnly="true"
                        hourFormat="24"
                        [showSeconds]="false"
                        [disabled]="esMotivoInactivo(getDatosDia(dia.codigo).idMotivo)"
                    ></p-calendar>

                  </td>

                  <td>
                    <p-calendar
                        [(ngModel)]="getDatosDia(dia.codigo).horasalida"
                        timeOnly="true"
                        hourFormat="24"
                        [showSeconds]="false"
                        [disabled]="esMotivoInactivo(getDatosDia(dia.codigo).idMotivo)"
                    ></p-calendar>
                  </td>
                </tr>
              </ng-template>
            </p-table>

            <div class="flex justify-content-end gap-2 mt-4">
                <button
                  pButton
                  type="button"
                  label="Cancelar"
                  class="p-button p-button-danger"
                  (click)="cerrarDialogo()"
                ></button>

                <button
                  pButton
                  type="button"
                  label="Guardar"
                  class="p-button custom-purple-button"
                  (click)="guardarHorario()"
                ></button>
            </div>
          </p-dialog>



        <p-table [value]="horarioPersonalLista" dataKey="idEmpleado" editMode="row"
               [paginator]="true" [rows]="20" responsiveLayout="scroll" scrollable="true" scrollDirection="horizontal" class="tabla-scroll.fija"
               >
        <ng-template pTemplate="header">
          <tr>
            <th class="w-6">nroDocumento</th>
            <th class="w-6">TipoDocumento</th>
            <th class="w-6">Apellidos</th>
            <th class="w-6">Nombres</th>
            <th class="w-6">NombreDept</th>
            <th class="w-6">NombreCargo</th>
            <th class="w-6">lunes</th>
            <th class="w-6">martes</th>
            <th class="w-6">miercoles</th>
            <th class="w-6">jueves</th>
            <th class="w-6">viernes</th>
            <th class="w-6">sabado</th>
            <th class="w-6">domingo</th>
            <th class="w-6">Acciones</th>

          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-horario let-ri="rowIndex" let-editing="editing">
          <tr [pEditableRow]="horario">
              <td [pEditableColumn]="editingRowIndex === ri ? horario.idEmpleado : null" [pEditableColumnField]="'idEmpleado'" style="display: none;">
                  <p-cellEditor *ngIf="editingRowIndex === ri">
                      <ng-template pTemplate="input">
                          <div class="p-inputgroup">
                              <input pInputText type="text" [(ngModel)]="horario.idEmpleado" class="p-inputtext-sm" required>
                          </div>
                      </ng-template>
                      <ng-template pTemplate="output">
                          {{ horario.idEmpleado }}
                      </ng-template>
                  </p-cellEditor>
                  <div *ngIf="editingRowIndex !== ri">
                      {{ horario.idEmpleado }}
                  </div>
              </td>
              <td>
                  <div>
                      {{ horario.nroDocumento }}
                  </div>
              </td>
              <td>
                <div>
                    {{ horario.tipoDocumento }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.apellidos }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.nombres }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.nombreDept }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.nombreCargo }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.lunes }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.martes }}
                </div>
            </td>
            <td>
                <div >
                    {{ horario.miercoles }}
                </div>
            </td>
            <td>
                <div >
                    {{ horario.jueves }}
                </div>
            </td>
            <td>
                <div>{{ horario.viernes }}</div>
            </td>
            <td>
                <div >
                    {{ horario.sabado }}
                </div>
            </td>
            <td>
                <div>
                    {{ horario.domingo }}
                </div>
            </td>
            <td>
                <div class="flex justify-content-center gap-2">
                <button pButton pInitEditableRow
                        (click)="abrirModalConDatos(horario.idEmpleado)"
                        icon="pi pi-pencil" pTooltip="Abrir Configuración"
                        [disabled]="isNew || isEditingAnyRow"
                        class="p-button-rounded p-button-text p-button-sm"></button>
                </div>
            </td>

          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

