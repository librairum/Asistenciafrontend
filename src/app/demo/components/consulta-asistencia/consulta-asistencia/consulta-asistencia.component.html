<!-- asistencia.component.html -->
<p-toast></p-toast>
<div class="m-3">
    <p-panel header="Consulta de Resumen de Asistencia">
        <p-breadcrumb class="max-w-full" [model]="items" />
        <br />
        <div class="grid align-items-center">
            <!-- Fecha de Inicio -->
            <div class="col-3 text-center">
                <div class="field">
                    <label for="startDate" class="mr-2 font-medium text-gray-700">Fecha de Inicio</label>
                    <br />
                    <p-calendar dateFormat="yy-mm-dd" [(ngModel)]="startDate" inputId="startDate" class="w-full"
                        placeholder="Selecciona una fecha" [locale]="espaniol" [showIcon]="true">
                    </p-calendar>
                </div>
            </div>

            <!-- Fecha Fin -->
            <div class="col-3 text-center">
                <div class="field">
                    <label for="endDate" class="mr-2 font-medium text-gray-700">Fecha Fin</label>
                    <br />
                    <p-calendar dateFormat="yy-mm-dd" [(ngModel)]="endDate" inputId="endDate" class="w-full"
                        placeholder="Selecciona una fecha" [showIcon]="true" class="col-3">
                    </p-calendar>
                </div>
            </div>

            <!-- Planilla -->
            <div class="col-3 text-center">
                <div class="field">
                    <label for="planilla" class="mr-2 font-medium text-gray-700">Planilla</label>
                    <br />
                    <p-dropdown [options]="planilla" optionLabel="nombrePlanilla" optionValue="codigoPlanilla"
                        placeholder="Selecciona la planilla" [(ngModel)]="selectedPlanilla" (onChange)="onPlanillaChange($event)" >
                    </p-dropdown>
                </div>
            </div>

            <!-- BotÃ³n Buscar -->
            <div class="col-3 text-center">
                <button pButton type="button" label="Buscar" icon="pi pi-search" (click)="cargarResumen()"
                    class="w-auto p-button-sm" style="margin-right: 10px;">
                </button>
                <button
                    pButton
                    type="button"
                    label="Exportar"
                    icon="pi pi-file-excel"
                    (click)="generateEXCEL()"
                    class="p-button-sm p-button-success"
                ></button>
            </div>
        </div>
    </p-panel>
</div>

<div class="m-3">
    <p-table #dt1 [value]="asistencia" [columns]="columnas" dataKey="item" [rows]="10"
        [rowsPerPageOptions]="[5,10, 20]" [paginator]="true" [loading]="loading"
        [tableStyle]="{ 'min-width': '75rem' }" [globalFilterFields]="columnsGlobalFilterFields" [filters]="filters">

        <ng-template pTemplate="header" let-columns>
            <!-- Fila para los filtros -->
            <tr>
                <th *ngFor="let col of columns">
                    {{ col.header }}
                </th>
            </tr>
            <tr>
                <th *ngFor="let col of columns">
                    <p-columnFilter *ngIf="col.field === 'nombretrabajador'"
                        type="text"
                        field="nombretrabajador"
                        placeholder="Ingrese el nombre del trabajador"
                        [showMenu]="false"
                        matchMode="contains">
                    </p-columnFilter>
                </th>
            </tr>
            <!-- Fila para los nombres de las columnas -->

        </ng-template>


        <ng-template pTemplate="body" let-rowData>
            <tr>
                <td>{{ rowData.item }}</td>
                <td>{{ rowData.nombretrabajador }}</td>
                <td>{{ rowData.dias }}</td>
                <td>{{ rowData.horas25 }}</td>
                <td>{{ rowData.horas60 }}</td>
                <td>{{ rowData.horas100 }}</td>
                <td>
                    <button pButton icon="pi pi-eye" label="Ver" class="p-button-sm" (click)="viewDetails(rowData)">
                    </button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7">No se encontraron registros.</td>
            </tr>
        </ng-template>
    </p-table>
</div>
